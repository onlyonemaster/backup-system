# ë©”íƒ€ë°ì´í„°ì— ìˆ˜ì • ë‚´ìš© ë¶„ì„ ê¸°ëŠ¥ ì¶”ê°€ ì„¤ê³„ì„œ

## ğŸ“‹ ìš”êµ¬ì‚¬í•­

### 1. ê¸°ë³¸ ìš”êµ¬ì‚¬í•­
- ë°±ì—… ì‹œ íŒŒì¼ì˜ ë³€ê²½ ë¼ì¸ ë²ˆí˜¸ì™€ ìˆ˜ì • ë‚´ìš© ì¶”ì¶œ
- DeepSeek APIë¥¼ ì‚¬ìš©í•œ AI ë¶„ì„ (ìˆ˜ì • ëª©ì /ì˜ë„ ì¶”ë¡ )
- ë©”íƒ€ë°ì´í„° JSONì— ìƒì„¸ ì •ë³´ ì €ì¥

### 2. ì¶œë ¥ í˜•ì‹
```json
{
  "changes": "5 lines modified",
  "changes_detail": [
    {
      "line_number": 42,
      "change_type": "added",
      "content": "// New feature for caching",
      "purpose": "Performance optimization - caching implementation"
    },
    {
      "line_number": 156,
      "change_type": "modified",
      "old_content": "  return result;",
      "new_content": "  return cached_result;",
      "purpose": "Cache layer integration"
    }
  ]
}
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
backup-kiamphp.sh (ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸)
â”œâ”€â”€ 1. íŒŒì¼ ë³µì‚¬
â”œâ”€â”€ 2. ê¸°ë³¸ ë©”íƒ€ì •ë³´ ìˆ˜ì§‘
â”œâ”€â”€ 3. diff ë¶„ì„
â”œâ”€â”€ 4. ë³€ê²½ ë¼ì¸ ì¶”ì¶œ
â”œâ”€â”€ 5. DeepSeek API í˜¸ì¶œ â† NEW
â”œâ”€â”€ 6. AI ë¶„ì„ ê²°ê³¼ í†µí•©
â””â”€â”€ 7. ë©”íƒ€ íŒŒì¼ ìƒì„±
```

---

## ğŸ“ êµ¬í˜„ ì „ëµ

### 1ë‹¨ê³„: ë³€ê²½ ë¼ì¸ ì¶”ì¶œ í•¨ìˆ˜
```bash
function extract_changes() {
    local prev_file=$1
    local new_file=$2
    
    # diff ì‹¤í–‰í•˜ì—¬ ë³€ê²½ëœ ë¼ì¸ ì¶”ì¶œ
    diff -u "$prev_file" "$new_file" | grep "^[+-]" | grep -v "^[+-]{3}"
}
```

**ì¶œë ¥ ì˜ˆ:**
```
-  return result;
+  return cached_result;
```

---

### 2ë‹¨ê³„: JSON í¬ë§· ìƒì„± (diff íŒŒì‹±)
```bash
function parse_diff_to_json() {
    local diff_output=$1
    
    # ë³€ê²½ ë‚´ìš©ì„ JSON ë°°ì—´ë¡œ ë³€í™˜
    # ë¼ì¸ ë²ˆí˜¸, íƒ€ì…(added/removed/modified), ë‚´ìš© ì¶”ì¶œ
}
```

**êµ¬ì¡°:**
```json
{
  "changes_detail": [
    {
      "line_number": 42,
      "change_type": "added",
      "content": "// New comment"
    }
  ]
}
```

---

### 3ë‹¨ê³„: DeepSeek API ì—°ë™

#### 3.1 API ì„¤ì •
```bash
DEEPSEEK_API_KEY="your_api_key"
DEEPSEEK_API_URL="https://api.deepseek.com/v1/chat/completions"
```

#### 3.2 API í˜¸ì¶œ í•¨ìˆ˜
```bash
function analyze_with_deepseek() {
    local change_content=$1
    local context=$2  # íŒŒì¼ëª…, í•¨ìˆ˜ëª… ë“± ì»¨í…ìŠ¤íŠ¸
    
    # DeepSeek API í˜¸ì¶œ
    curl -X POST "$DEEPSEEK_API_URL" \
      -H "Authorization: Bearer $DEEPSEEK_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "model": "deepseek-chat",
        "messages": [
          {
            "role": "user",
            "content": "ë¶„ì„í•´ì¤„ ì½”ë“œ ë³€ê²½:\n$change_content\n\nê°„ë‹¨íˆ (1ì¤„) ìˆ˜ì • ëª©ì ì„ í•œêµ­ì–´ë¡œ ì„¤ëª…í•˜ì„¸ìš”."
          }
        ],
        "max_tokens": 100,
        "temperature": 0.3
      }'
}
```

---

### 4ë‹¨ê³„: ë©”íƒ€ íŒŒì¼ ìƒì„± (í™•ì¥)

**ê¸°ì¡´:**
```json
{
  "changes": "5 lines modified"
}
```

**ìƒˆë¡œìš´ í˜•ì‹:**
```json
{
  "changes": "5 lines modified",
  "changes_detail": [
    {
      "line_number": 42,
      "change_type": "added",
      "content": "// Cache implementation",
      "purpose": "ì„±ëŠ¥ ìµœì í™” - ìºì‹± ë ˆì´ì–´ ì¶”ê°€",
      "ai_confidence": 0.95
    },
    {
      "line_number": 156,
      "change_type": "modified",
      "old_content": "return result;",
      "new_content": "return cached_result;",
      "purpose": "ìºì‹œëœ ê²°ê³¼ ë°˜í™˜ìœ¼ë¡œ ì‘ë‹µì†ë„ ê°œì„ ",
      "ai_confidence": 0.92
    }
  ]
}
```

---

## ğŸ”§ êµ¬í˜„ ê³„íš

### Phase 1: ê¸°ë³¸ diff ë¶„ì„ (diff íŒŒì‹±)
**ì†Œìš” ì‹œê°„:** 2-3ì‹œê°„

- âœ… diff ì¶”ì¶œ í•¨ìˆ˜ ì‘ì„±
- âœ… ë¼ì¸ ë²ˆí˜¸ ì¶”ì¶œ
- âœ… ë³€ê²½ íƒ€ì… ë¶„ë¥˜ (added/removed/modified)
- âœ… JSON êµ¬ì¡° ìƒì„±

**ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼:**
```
scripts/lib/diff-analyzer.sh (ìƒˆ íŒŒì¼)
```

---

### Phase 2: DeepSeek API ì—°ë™
**ì†Œìš” ì‹œê°„:** 2-3ì‹œê°„

- âœ… API í‚¤ ì„¤ì • (í™˜ê²½ ë³€ìˆ˜)
- âœ… API í˜¸ì¶œ í•¨ìˆ˜ ì‘ì„±
- âœ… ì‘ë‹µ íŒŒì‹±
- âœ… ì—ëŸ¬ ì²˜ë¦¬

**ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼:**
```
scripts/lib/ai-analyzer.sh (ìƒˆ íŒŒì¼)
```

---

### Phase 3: backup-kiamphp.sh í†µí•©
**ì†Œìš” ì‹œê°„:** 1-2ì‹œê°„

- âœ… ê¸°ì¡´ ë¡œì§ì— ìƒˆ í•¨ìˆ˜ í†µí•©
- âœ… ë©”íƒ€ íŒŒì¼ í™•ì¥
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°±

**ìˆ˜ì • íŒŒì¼:**
```
scripts/backup-kiamphp.sh (ê¸°ì¡´ ìˆ˜ì •)
```

---

## ğŸ“Š ì„¤ê³„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   backup-kiamphp.sh ì‹¤í–‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º íŒŒì¼ ë³µì‚¬
               â”‚
               â”œâ”€â–º diff ì‹¤í–‰
               â”‚   â””â”€â–º diff-analyzer.sh
               â”‚       â”œâ”€ ë¼ì¸ ë²ˆí˜¸ ì¶”ì¶œ
               â”‚       â”œâ”€ ë³€ê²½ íƒ€ì… ë¶„ë¥˜
               â”‚       â””â”€ JSON ë³€í™˜
               â”‚
               â”œâ”€â–º AI ë¶„ì„ (ì„ íƒì )
               â”‚   â””â”€â–º ai-analyzer.sh
               â”‚       â”œâ”€ DeepSeek API í˜¸ì¶œ
               â”‚       â””â”€ ëª©ì  ì¶”ë¡ 
               â”‚
               â””â”€â–º ë©”íƒ€ íŒŒì¼ ìƒì„±
                   â””â”€ changes_detail ì¶”ê°€
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. API í‚¤ ê´€ë¦¬
```bash
# /etc/backup/config.sh (ìˆ¨ê¹€ íŒŒì¼)
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxx"
DEEPSEEK_MAX_RETRIES=3
DEEPSEEK_TIMEOUT=10
```

### 2. ìœ¨ ì œí•œ (Rate Limiting)
- API í˜¸ì¶œ íšŸìˆ˜ ì œí•œ
- ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
- ìºì‹± ë©”ì»¤ë‹ˆì¦˜

### 3. ì—ëŸ¬ ì²˜ë¦¬
```bash
# API ì‹¤íŒ¨ ì‹œ í´ë°±
if [ $? -ne 0 ]; then
    purpose="ë¶„ì„ ì‹¤íŒ¨ (AI ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€)"
fi
```

---

## ğŸ¯ ì¥ì 

### 1. ê°œë°œì ê²½í—˜ í–¥ìƒ
- ë¬´ì—‡ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ëª…í™•
- ì™œ ë³€ê²½í–ˆëŠ”ì§€ ìë™ ë¶„ì„
- ë³€ê²½ ì´ë ¥ ì¶”ì  ìš©ì´

### 2. ê°ì‹œ ë° ì¶”ì 
- ë¹„ì •ìƒì ì¸ ë³€ê²½ ê°ì§€
- ì˜ë„í•˜ì§€ ì•Šì€ ìˆ˜ì • ë°œê²¬
- ê·œì • ì¤€ìˆ˜ ê²€ì¦

### 3. ë¬¸ì„œí™” ìë™í™”
- ìˆ˜ì • ì´ë ¥ ìë™ ë¬¸ì„œí™”
- ë³€ê²½ ë¡œê·¸ ìƒì„±
- ê°ì‚¬(Audit) ê¸°ë¡

---

## âš ï¸ ê³ ë ¤ ì‚¬í•­

### 1. ì„±ëŠ¥
- í° íŒŒì¼ì˜ diff ë¶„ì„ ì‹œê°„ ì¦ê°€
- API í˜¸ì¶œ ì‹œê°„ (100-500ms)
- í•´ê²°: ë¹„ë™ê¸° ì²˜ë¦¬ ë˜ëŠ” ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

### 2. ë¹„ìš©
- DeepSeek API ì‚¬ìš©ë£Œ
- ì›” ~ ë³€ê²½ ìˆ˜ì— ë”°ë¼ ë³€ë™
- í•´ê²°: API í˜¸ì¶œ ìµœì í™”, ë°°ì¹˜ ì²˜ë¦¬

### 3. ì •í™•ë„
- AI ë¶„ì„ ì •í™•ë„ ~90%
- ë³µì¡í•œ ë¡œì§ì€ ë¶€ì •í™•í•  ìˆ˜ ìˆìŒ
- í•´ê²°: ì‹ ë¢°ë„ ì ìˆ˜ í¬í•¨

---

## ğŸ“‹ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: diff ë¶„ì„
- [ ] diff-analyzer.sh ì‘ì„±
- [ ] ë¼ì¸ ë²ˆí˜¸ ì¶”ì¶œ ë¡œì§
- [ ] JSON í¬ë§· í…ŒìŠ¤íŠ¸
- [ ] í†µí•© í…ŒìŠ¤íŠ¸

### Phase 2: AI ì—°ë™
- [ ] config.shì— API í‚¤ ì¶”ê°€
- [ ] ai-analyzer.sh ì‘ì„±
- [ ] DeepSeek API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
- [ ] ì‘ë‹µ íŒŒì‹± ë¡œì§

### Phase 3: í†µí•©
- [ ] backup-kiamphp.sh ìˆ˜ì •
- [ ] ë©”íƒ€ íŒŒì¼ í™•ì¥
- [ ] ì—ëŸ¬ ì²˜ë¦¬
- [ ] ìµœì¢… í…ŒìŠ¤íŠ¸

---

## ğŸš€ êµ¬í˜„ ìˆœì„œ ì œì•ˆ

**1ë‹¨ê³„ (1ì¼):** diff ë¶„ì„ ê¸°ëŠ¥ë§Œ êµ¬í˜„
- JSON í¬ë§· ì™„ì„±
- ì •ìƒ ì‘ë™ í™•ì¸

**2ë‹¨ê³„ (1ì¼):** DeepSeek API ì—°ë™
- API ì—°ê²° í…ŒìŠ¤íŠ¸
- ì‘ë‹µ íŒŒì‹±

**3ë‹¨ê³„ (1ì¼):** í†µí•© ë° ìµœì í™”
- ì„±ëŠ¥ íŠœë‹
- ì—ëŸ¬ ì²˜ë¦¬

---

## ğŸ’¡ ëŒ€ì•ˆ ê²€í† 

### Option A: í˜„ì¬ ì œì•ˆ (DeepSeek API)
- âœ… ì‹¤ì‹œê°„ ë¶„ì„
- âœ… ì •í™•ë„ ë†’ìŒ
- âŒ API ë¹„ìš© ë°œìƒ

### Option B: ë¡œì»¬ AI (Ollama)
- âœ… ë¹„ìš© ë¬´ë£Œ
- âœ… ì˜¤í”„ë¼ì¸ ì‘ë™
- âŒ ì„±ëŠ¥ ë‚®ì„ ìˆ˜ ìˆìŒ

### Option C: íŒ¨í„´ ê¸°ë°˜ ë¶„ì„
- âœ… ë¹ ë¥´ê³  ë¬´ë£Œ
- âŒ ì •í™•ë„ ë‚®ìŒ

**ì¶”ì²œ: Option A (DeepSeek API)** - ì •í™•ë„ì™€ ì‹ ë¢°ì„± ìµœìš°ì„ 

